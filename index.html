<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>File Explorer</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root {
      --bg: #f8f9fa;
      --card: #ffffff;
      --primary: #0078d4;
      --text: #333;
      --border: #e1e1e1;
      --hover: #f0f0f0;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #1e1e1e;
        --card: #2d2d2d;
        --text: #e0e0e0;
        --border: #444;
        --hover: #383838;
      }
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 10px;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .header {
      background: var(--card);
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 14px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .path {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .path span {
      color: var(--primary);
      cursor: pointer;
    }

    .path span:hover { text-decoration: underline; }

    .back-btn {
      background: none;
      border: none;
      font-size: 18px;
      color: var(--text);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .back-btn:hover { background: var(--hover); }

    .view-toggle {
      display: flex;
      gap: 5px;
    }

    .view-btn {
      background: none;
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }

    .view-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .container {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .files-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 16px;
    }

    .files-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .file-item {
      background: var(--card);
      border-radius: 8px;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
      user-select: none;
    }

    .file-item:hover {
      background: var(--hover);
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .file-item.folder {
      color: #ffb900;
    }

    .file-item i {
      font-size: 36px;
      margin-bottom: 8px;
      display: block;
    }

    .file-name {
      font-size: 12px;
      word-break: break-word;
      margin-top: 4px;
      color: var(--text);
    }

    .file-item.list {
      display: flex;
      align-items: center;
      gap: 12px;
      text-align: left;
      padding: 8px 12px;
    }

    .file-item.list i {
      font-size: 24px;
      width: 30px;
    }

    .empty {
      text-align: center;
      padding: 40px;
      color: #888;
      font-size: 14px;
    }

    @media (max-width: 600px) {
      .files-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 12px;
      }
      .header {
        font-size: 13px;
        padding: 10px;
      }
    }
  </style>
</head>
<body>

  <div class="header">
    <button class="back-btn" id="backBtn" style="display:none;">
      <i class="fas fa-arrow-left"></i>
    </button>
    <div class="path" id="pathDisplay">/</div>
    <div class="view-toggle">
      <button class="view-btn active" id="gridView"><i class="fas fa-th"></i></button>
      <button class="view-btn" id="listView"><i class="fas fa-list"></i></button>
    </div>
  </div>

  <div class="container" id="container">
    <div class="empty">Memuat file...</div>
  </div>

  <script>
    // Simulasi struktur folder dari file di folder yang sama
    const currentDir = location.pathname.split('/').slice(0, -1).join('/') || '/';
    let history = [''];
    let currentPath = '';

    const container = document.getElementById('container');
    const pathDisplay = document.getElementById('pathDisplay');
    const backBtn = document.getElementById('backBtn');
    const gridViewBtn = document.getElementById('gridView');
    const listViewBtn = document.getElementById('listView');

    // Ekstensi → ikon
    const fileIcons = {
      'pdf': 'fa-file-pdf',
      'jpg|jpeg|png|gif|webp|svg': 'fa-file-image',
      'mp4|webm|ogg': 'fa-file-video',
      'mp3|wav': 'fa-file-audio',
      'txt|md|log': 'fa-file-lines',
      'zip|rar|7z': 'fa-file-zipper',
      'doc|docx': 'fa-file-word',
      'xls|xlsx': 'fa-file-excel',
      'ppt|pptx': 'fa-file-powerpoint',
      'html|htm': 'fa-globe',
      'js': 'fa-code',
      'css': 'fa-paint-brush',
      'json': 'fa-brackets-curly',
      'default': 'fa-file'
    };

    function getIconClass(filename) {
      const ext = filename.split('.').pop().toLowerCase();
      for (const [exts, icon] of Object.entries(fileIcons)) {
        if (exts.split('|').includes(ext)) return icon;
      }
      return filename.includes('.') ? fileIcons.default : 'fa-folder';
    }

    function isFolder(name) {
      return !name.includes('.');
    }

    function formatSize(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    async function loadDirectory(path = '') {
      // Karena GitHub Pages statis, kita harus "hardcode" atau pakai trik
      // Di sini kita pakai trik: baca dari <a> yang dibuat oleh GitHub
      try {
        const res = await fetch(location.origin + location.pathname + path);
        const html = await res.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const links = Array.from(doc.querySelectorAll('a'))
          .map(a => a.getAttribute('href'))
          .filter(h => h && !h.startsWith('..') && h !== '/' && !h.endsWith('/'))
          .map(h => h.replace(location.pathname, '').replace(/^\//, ''));

        // Filter hanya file di folder ini
        const items = links
          .filter(name => {
            const fullPath = path + name;
            const depth = fullPath.split('/').filter(Boolean).length;
            return depth === (path.split('/').filter(Boolean).length + 1);
          });

        renderFiles(items, path);
      } catch (e) {
        container.innerHTML = `<div class="empty">Gagal memuat folder.</div>`;
      }
    }

    // Alternatif: Jika trik di atas gagal, gunakan daftar manual
    const MANUAL_FILES = [
      "gambar.jpg",
      "dokumen.pdf",
      "video.mp4",
      "data.csv",
      "Folder Ku",
      "Folder Ku/laporan.docx",
      "Folder Ku/presentasi.pptx"
    ];

    function renderFiles(files, path = '') {
      currentPath = path;
      history = history.slice(0, history.indexOf(path) + 1);
      if (!history.includes(path)) history.push(path);

      updatePathDisplay();
      backBtn.style.display = path ? 'block' : 'none';

      if (files.length === 0) {
        container.innerHTML = `<div class="empty">Folder kosong.</div>`;
        return;
      }

      const isGrid = gridViewBtn.classList.contains('active');
      const wrapper = document.createElement('div');
      wrapper.className = isGrid ? 'files-grid' : 'files-list';

      files.forEach(name => {
        const fullName = path + name;
        const isDir = isFolder(name) || name.endsWith('/');
        const item = document.createElement('div');
        item.className = `file-item ${isGrid ? '' : 'list'} ${isDir ? 'folder' : ''}`;
        
        const icon = getIconClass(name);
        const displayName = name.split('/').pop();

        if (isGrid) {
          item.innerHTML = `
            <i class="fas ${icon}"></i>
            <div class="file-name">${displayName}</div>
          `;
        } else {
          item.innerHTML = `
            <i class="fas ${icon}"></i>
            <div style="flex:1; font-size:14px;">${displayName}</div>
            <div style="font-size:12px; color:#888;">${isDir ? 'Folder' : 'File'}</div>
          `;
        }

        item.onclick = () => {
          if (isDir) {
            loadDirectory(fullName + '/');
          } else {
            window.open(location.href + fullName, '_blank');
          }
        };

        wrapper.appendChild(item);
      });

      container.innerHTML = '';
      container.appendChild(wrapper);
    }

    function updatePathDisplay() {
      const parts = currentPath.split('/').filter(Boolean);
      const html = parts.length === 0 
        ? '/' 
        : parts.map((p, i) => {
            const pathUpTo = parts.slice(0, i+1).join('/') + '/';
            return `<span onclick="loadDirectory('${pathUpTo}')">${p}</span>`;
          }).join(' / ');
      pathDisplay.innerHTML = html || '/';
    }

    // Event Listeners
    backBtn.onclick = () => {
      if (history.length > 1) {
        history.pop();
        loadDirectory(history[history.length - 1]);
      }
    };

    gridViewBtn.onclick = () => {
      gridViewBtn.classList.add('active');
      listViewBtn.classList.remove('active');
      renderFiles(Array.from(container.querySelectorAll('.file-item')).map(el => el.querySelector('.file-name').textContent), currentPath);
    };

    listViewBtn.onclick = () => {
      listViewBtn.classList.add('active');
      gridViewBtn.classList.remove('active');
      renderFiles(Array.from(container.querySelectorAll('.file-item')).map(el => el.querySelector('.file-name').textContent), currentPath);
    };

    // Inisialisasi
    window.onload = () => {
      // Coba pakai trik GitHub, jika gagal → pakai manual
      loadDirectory().catch(() => {
        // Fallback: gunakan daftar manual
        const rootFiles = MANUAL_FILES.filter(f => !f.includes('/'));
        renderFiles(rootFiles);
      });
    };
  </script>
</body>
</html>
