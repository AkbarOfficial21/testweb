<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Explorer - Semua File Otomatis</title>
    <style>
        :root {
            --primary: #3498db;
            --bg: #f8f9fa;
            --card: #fff;
            --text: #333;
            --border: #e0e0e0;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        header { background: #2c3e50; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        h1 { font-size: 1.8rem; }
        .search { display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap; }
        input, select, button {
            padding: 10px; border: 1px solid var(--border); border-radius: 5px; font-size: 1rem;
        }
        button { background: var(--primary); color: white; border: none; cursor: pointer; }
        button:hover { background: #2980b9; }
        .stats { display: flex; gap: 15px; flex-wrap: wrap; margin: 20px 0; }
        .stat { background: var(--card); padding: 15px; border-radius: 8px; flex: 1; min-width: 120px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .stat-value { font-size: 1.8rem; font-weight: bold; color: var(--primary); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; }
        .card { background: var(--card); border-radius: 8px; overflow: hidden; box-shadow: 0 3px 8px rgba(0,0,0,0.1); cursor: pointer; transition: 0.3s; }
        .card:hover { transform: translateY(-4px); box-shadow: 0 6px 16px rgba(0,0,0,0.15); }
        .icon { height: 100px; background: #f1f8ff; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; }
        .info { padding: 12px; }
        .name { font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .details { font-size: 0.85rem; color: #666; display: flex; justify-content: space-between; margin: 5px 0; }
        .type { padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; margin-top: 6px; display: inline-block; }
        .type-image { background: #e8f5e9; color: #2e7d32; }
        .type-document { background: #e3f2fd; color: #1565c0; }
        .type-video { background: #e8eaf6; color: #283593; }
        .type-audio { background: #fff3e0; color: #ef6c00; }
        .type-archive { background: #fce4ec; color: #c2185b; }
        .type-folder { background: #fff9c4; color: #f57f17; }
        .type-other { background: #f5f5f5; color: #616161; }
        .preview { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999; justify-content: center; align-items: center; padding: 20px; }
        .preview-content { background: white; border-radius: 8px; max-width: 90%; max-height: 90%; overflow: auto; padding: 20px; position: relative; }
        .close { position: absolute; top: 10px; right: 15px; font-size: 1.8rem; cursor: pointer; color: #999; }
        .preview img, .preview video, .preview iframe { max-width: 100%; max-height: 70vh; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .spinner { border: 4px solid #f0f0f0; border-left: 4px solid var(--primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr 1fr; } }
        @media (max-width: 480px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>File Explorer Otomatis</h1>
        <p>Semua file & folder di direktori ini akan otomatis terbaca</p>
    </header>

    <div class="search">
        <input type="text" id="search" placeholder="Cari file...">
        <select id="filter">
            <option value="">Semua</option>
            <option value="image">Gambar</option>
            <option value="document">Dokumen</option>
            <option value="video">Video</option>
            <option value="audio">Audio</option>
            <option value="folder">Folder</option>
        </select>
        <button id="refresh">Refresh</button>
    </div>

    <div class="stats">
        <div class="stat"><div class="stat-value" id="count">0</div><div>File</div></div>
        <div class="stat"><div class="stat-value" id="size">0 KB</div><div>Ukuran</div></div>
        <div class="stat"><div class="stat-value" id="types">0</div><div>Jenis</div></div>
    </div>

    <div id="files" class="grid">
        <div class="loading"><div class="spinner"></div><p>Memuat file dari GitHub...</p></div>
    </div>
</div>

<div id="preview" class="preview">
    <div class="preview-content">
        <span class="close">×</span>
        <div id="preview-body"></div>
    </div>
</div>

<script>
    const filesDiv = document.getElementById('files');
    const preview = document.getElementById('preview');
    const previewBody = document.getElementById('preview-body');
    const closeBtn = document.querySelector('.close');

    // Ambil semua file dari halaman direktori GitHub
    async function loadFiles() {
        filesDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Memindai direktori...</p></div>';
        
        try {
            const res = await fetch(location.href);
            const html = await res.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            const links = Array.from(doc.querySelectorAll('a'))
                .map(a => a.getAttribute('href'))
                .filter(href => href && !href.startsWith('?') && href !== '../' && href !== '/')
                .map(href => href.replace(/^\//, '')) // Hapus awal /
                .filter(name => name && !name.includes('?')) // Hindari query
                .map(name => name.endsWith('/') ? name.slice(0, -1) : name); // Hapus trailing /

            const uniqueFiles = [...new Set(links)];
            renderFiles(uniqueFiles);
        } catch (e) {
            filesDiv.innerHTML = `<p style="color:red; text-align:center;">Gagal membaca folder. Pastikan GitHub Pages aktif dan folder tidak kosong.</p>`;
        }
    }

    function getType(name) {
        if (name.includes('.')) {
            const ext = name.split('.').pop().toLowerCase();
            if (['jpg','jpeg','png','gif','webp','svg','bmp'].includes(ext)) return 'image';
            if (['pdf','doc','docx','txt','md','xls','xlsx','ppt','pptx'].includes(ext)) return 'document';
            if (['mp4','webm','ogg','mov','avi'].includes(ext)) return 'video';
            if (['mp3','wav','ogg','m4a'].includes(ext)) return 'audio';
            return 'other';
        }
        return 'folder';
    }

    function getIcon(type) {
        const icons = {
            image: 'image', document: 'document', video: 'video', audio: 'volume_up', folder: 'folder', other: 'description'
        };
        return icons[type] || 'description';
    }

    function formatSize(bytes) {
        if (!bytes) return '—';
        const units = ['B', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(1024));
        return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + units[i];
    }

    function renderFiles(allFiles) {
        const search = document.getElementById('search').value.toLowerCase();
        const filter = document.getElementById('filter').value;

        let files = allFiles.filter(f => 
            f.toLowerCase().includes(search) && 
            (!filter || getType(f) === filter)
        );

        if (files.length === 0) {
            filesDiv.innerHTML = '<p style="text-align:center; color:#666; grid-column:1/-1;">Tidak ada file ditemukan.</p>';
            updateStats([]);
            return;
        }

        filesDiv.innerHTML = '';
        let totalSize = 0;
        const types = new Set();

        files.forEach(name => {
            const type = getType(name);
            types.add(type);

            const card = document.createElement('div');
            card.className = 'card';
            card.onclick = () => openFile(name, type);

            card.innerHTML = `
                <div class="icon"><span class="material-icons">${getIcon(type)}</span></div>
                <div class="info">
                    <div class="name" title="${name}">${name}</div>
                    <div class="details">
                        <span>${type === 'folder' ? 'Folder' : 'File'}</span>
                        <span>—</span>
                    </div>
                    <div class="type type-${type}">${type.toUpperCase()}</div>
                </div>
            `;
            filesDiv.appendChild(card);
        });

        updateStats(files);
    }

    function updateStats(files) {
        document.getElementById('count').textContent = files.length;
        document.getElementById('types').textContent = new Set(files.map(getType)).size;
        document.getElementById('size').textContent = '—';
    }

    function openFile(name, type) {
        if (type === 'folder') {
            window.location.href = name + '/';
            return;
        }

        previewBody.innerHTML = `<div class="loading"><div class="spinner"></div><p>Memuat ${name}...</p></div>`;
        preview.style.display = 'flex';

        if (type === 'image') {
            previewBody.innerHTML = `<img src="${name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2ZmZiIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5Ij5ObyBJbWFnZTwvdGV4dD48L3N2Zz4='">`;
        } else if (type === 'video') {
            previewBody.innerHTML = `<video controls><source src="${name}" type="video/mp4">Browser tidak mendukung video.</video>`;
        } else if (type === 'document' && name.endsWith('.pdf')) {
            previewBody.innerHTML = `<iframe src="${name}" style="width:100%;height:80vh;"></iframe>`;
        } else {
            previewBody.innerHTML = `<p>Pratinjau tidak tersedia. <a href="${name}" download>Download ${name}</a></p>`;
        }
    }

    // Event
    document.getElementById('refresh').onclick = loadFiles;
    document.getElementById('search').oninput = () => setTimeout(loadFiles, 300);
    document.getElementById('filter').onchange = loadFiles;
    closeBtn.onclick = () => preview.style.display = 'none';
    preview.onclick = (e) => { if (e.target === preview) preview.style.display = 'none'; };

    // Load saat buka
    loadFiles();

    // Tambahkan Font Material Icons
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = 'https://fonts.googleapis.com/icon?family=Material+Icons';
    document.head.appendChild(link);
</script>

</body>
</html>
